FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGVsYXN0aWNzZWFyY2gtYXBiCmRlc2NyaXB0aW9uOiBUaGlzIGlz\
IGFuIEFQQiB0byBkZXBsb3kgYSBzZWN1cmVkIEVsYXN0aWNzZWFyY2ggaW5zdGFuY2UKYmluZGFi\
bGU6IFRydWUKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGltYWdlVXJsOiBodHRwczovL3d3\
dy5lbGFzdGljLmNvL2Fzc2V0cy9ibHQ5YTI2Zjg4YmZiZDIwZWI1L2ljb24tZWxhc3RpY3NlYXJj\
aC1iYi5zdmcKICBkb2N1bWVudGF0aW9uVXJsOiBodHRwczovL3d3dy5lbGFzdGljLmNvL2d1aWRl\
L2VuL2VsYXN0aWNzZWFyY2gvcmVmZXJlbmNlLzUuNS9pbmRleC5odG1sCiAgZGlzcGxheU5hbWU6\
IEVsYXN0aWNzZWFyY2ggKEFQQikKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlw\
dGlvbjogRGVwbG95cyBhbiBFbGFzdGljc2VhcmNoIGluc3RhbmNlIHNlY3VyZWQgYnkgU2VhcmNo\
R3VhcmQKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAg\
IC0gbmFtZTogRVNfSU1BR0UKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6IHJ1cm9t\
ZXJvL2VzLWFwYi1kZW1vOmxhdGVzdAogICAgICBkZXNjcmlwdGlvbjogRG9ja2VyIGltYWdlIHdp\
dGggRWxhc3RpY3NlYXJjaCB3aXRoIFNlYXJjaGd1YXJkCiAgICAgIHRpdGxlOiBFbGFzdGljc2Vh\
cmNoIGltYWdlCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAtIG5hbWU6IENMVVNURVJfTkFNRQog\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogZWxhc3RpY3NlYXJjaAogICAgICBkZXNj\
cmlwdGlvbjogTmFtZSBvZiB0aGUgRWxhc3RpY3NlYXJjaCBjbHVzdGVyCiAgICAgIHRpdGxlOiBF\
bGFzdGljc2VhcmNoIGNsdXN0ZXIgbmFtZQogICAgICByZXF1aXJlZDogdHJ1ZQogICAgLSBuYW1l\
OiBlbGFzdGljc2VhcmNoX2NsaWVudF91c2VybmFtZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ZGVmYXVsdDogZXNjbGllbnQKICAgICAgdGl0bGU6IEVsYXN0aWNzZWFyY2ggY2xpZW50IHVzZXIK\
ICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIC0gbmFtZTogZWxhc3RpY3NlYXJjaF9jbGllbnRfcGFz\
c3dvcmQKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBFbGFzdGljc2VhcmNoIGNsaWVu\
dCBwYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogQSByYW5kb20gYWxwaGFudW1lcmljIHN0cmlu\
ZyBpZiBsZWZ0IGJsYW5rCiAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgcmVxdWly\
ZWQ6IGZhbHNlCg=="

RUN yum install -y py-bcrypt java-1.8.0-openjdk-headless && yum clean all

COPY files/etc/ansible/ansible.cfg /etc/ansible/ansible.cfg
COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY filter_plugins /opt/ansible/filter_plugins

RUN chmod -R g=u /opt/{ansible,apb}
USER apb
